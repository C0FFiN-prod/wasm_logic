<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Логический симулятор</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="tip" id="tip"></div>
    <button class="setting-btn" id="settings-toggle"><svg xmlns="http://www.w3.org/2000/svg" fill="var(--text)"
            stroke="none" viewBox="-1 -1 18 6" fill-rule="evenodd" clip-rule="evenodd">
            <path
                d="M4 2C4 3.10457 3.10457 4 2 4C0.89543 4 0 3.10457 0 2C0 0.89543 0.89543 0 2 0C3.10457 0 4 0.89543 4 2Z M10 2C10 3.10457 9.10457 4 8 4C6.89543 4 6 3.10457 6 2C6 0.89543 6.89543 0 8 0C9.10457 0 10 0.89543 10 2Z M16 2C16 3.10457 15.1046 4 14 4C12.8954 4 12 3.10457 12 2C12 0.89543 12.8954 0 14 0C15.1046 0 16 0.89543 16 2Z" />
        </svg></button>
    <div id="settings-menu" class="hidden">
        <button class="setting-btn" id="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" fill="transparent"
                stroke="var(--text)" viewBox="-1 -1 19 19" fill-rule="evenodd" clip-rule="evenodd"></svg></button>
        <button class="setting-btn" id="locale-toggle"><svg xmlns="http://www.w3.org/2000/svg" fill="transparent"
                stroke="var(--text)" viewBox="0 0 24 24" fill-rule="evenodd" clip-rule="evenodd">
            <path d="m7.508,9.196c-.107-.464-.403-.886-.842-1.07-.206-.086-.413-.126-.613-.126-.689,0-1.287.475-1.443,1.147l-1.475,6.252c-.072.307.16.601.476.601.226,0,.422-.155.475-.375l.389-1.625h3.115l.374,1.621c.051.222.249.379.476.379h.012c.314,0,.546-.292.476-.598l-1.422-6.206Zm-2.793,3.804l.869-3.627c.051-.219.244-.373.469-.373.073,0,.149.016.226.049.111.046.213.197.253.371l.827,3.58h-2.645Zm14.805-9H4.52C2.038,4,.02,6.019.02,8.5v7c0,2.481,2.019,4.5,4.5,4.5h15c2.481,0,4.5-2.019,4.5-4.5v-7c0-2.481-2.019-4.5-4.5-4.5ZM1.02,15.5v-7c0-1.93,1.57-3.5,3.5-3.5h7v14h-7c-1.93,0-3.5-1.57-3.5-3.5Zm22,0c0,1.93-1.57,3.5-3.5,3.5h-7V5h7c1.93,0,3.5,1.57,3.5,3.5v7Zm-1-6.009v.018c0,.271-.22.491-.491.491h-.546c-.107.917-.517,2.904-2.085,4.341.701.354,1.574.595,2.658.648.26.013.464.229.464.49v.018c0,.281-.235.505-.516.491-1.469-.071-2.605-.448-3.484-.986-.879.538-2.015.915-3.484.986-.28.014-.516-.21-.516-.491v-.018c0-.26.204-.477.464-.49,1.085-.054,1.957-.295,2.659-.648-.54-.495-.943-1.055-1.243-1.614-.176-.329.059-.727.432-.727.181,0,.345.1.432.259.291.534.695,1.066,1.257,1.519,1.474-1.185,1.862-2.925,1.964-3.777h-5.473c-.271,0-.491-.22-.491-.491v-.018c0-.271.22-.491.491-.491h3.009v-.509c0-.271.22-.491.491-.491h.018c.271,0,.491.22.491.491v.509h3.009c.271,0,.491.22.491.491Z"/>
        </svg></button>
        <button class="setting-btn" id="user-manual-toggle"><svg xmlns="http://www.w3.org/2000/svg" fill="transparent"
                stroke="var(--text)" viewBox="-1 -1 19 19" fill-rule="evenodd" clip-rule="evenodd">
                <path
                    d="M8.49997 11.125C8.49997 7.99994 9.5 9 10.5 7.5C12 5.5 10.5 3.50004 8.49999 3.5C6.49999 3.49996 4.99998 5.5 6.5 7.5M16.5 8.5C16.5 12.9183 12.9183 16.5 8.5 16.5C4.08172 16.5 0.5 12.9183 0.5 8.5C0.5 4.08172 4.08172 0.5 8.5 0.5C12.9183 0.5 16.5 4.08172 16.5 8.5ZM9 13.5C9 13.7761 8.77614 14 8.5 14C8.22386 14 8 13.7761 8 13.5C8 13.2239 8.22386 13 8.5 13C8.77614 13 9 13.2239 9 13.5Z"
                    stroke-linecap="round" />
            </svg></button>
    </div>


    <div class="floating-menu hidden" id="fm-logeq" style="left: 200px; top: 100px; z-index: 10;">
        <div class="floating-menu-header">
            <span>LogEq Editor</span>
            <button class="hide"></button>
        </div>
        <div class="floating-menu-container flex col justify">
            <textarea name="logeq-text" id="logeq-text" cols="60" rows="10" placeholder="A = S0; 
B = B0;
L0 = A ^ B;"></textarea>
            <div class="flex row between">
                <button id="logeq-clear">Clear</button>
                <label class="align-content-center lh-1">
                    Flatten:
                    <input type="checkbox" id="logeq-flatten">
                </label>

                <label class="align-content-center">
                    Args:
                    <select name="logeq-input-el" id="logeq-input-el">
                        <option value="AND">AND</option>
                        <option value="SWITCH">Switch</option>
                        <option value="BUTTON">Button</option>
                    </select>
                </label>

                <button id="logeq-parse">Parse</button>
            </div>
        </div>
    </div>
    <div class="floating-menu" style="left: 20px; top: 20px;" data-locale-section="floating-menu-tools">
        <div class="floating-menu-header">
            <span data-locale="header"></span>
            <input type="checkbox">
        </div>
        <div class="floating-menu-container flex col">
            <button id="tool-move" class="tool-button" data-locale="move"></button>
            <button id="tool-connect" class="tool-button" data-locale="connect"></button>
            <div class="flex gap-1">
                <input type="color" id="tool-color-picker" value="#222222">
                <button id="tool-paint" class="tool-button flex-1">Paint</button>
            </div>
            <hr>
            <button id="copy-wires-mode-btn">Copy wires: Inner</button>
            <button id="show-wires-mode-btn">Show wires: Connect</button>
            <hr>
            <button id="toggle-logeq-editor">Edit LogEq</button>
        </div>
    </div>

    <div class="floating-menu" style="left: 20px; top: 420px;" data-locale-section="floating-menu-elements">
        <div class="floating-menu-header">
            <span data-locale="header"></span>
            <input type="checkbox">
        </div>
        <div class="floating-menu-container flex col justify">
            <button id="add-and">AND</button>
            <button id="add-or">OR</button>
            <button id="add-xor">XOR</button>
            <button id="add-nand">NAND</button>
            <button id="add-nor">NOR</button>
            <button id="add-xnor">XNOR</button>
            <button id="add-t_flop">T-Flop</button>
            <button id="add-timer">Timer</button>
            <button id="add-button">Button</button>
            <button id="add-switch">Switch</button>
            <button id="add-output">Output</button>
        </div>
    </div>

    <div class="floating-menu" style="left: 50%; top: 20px;">
        <div class="floating-menu-header">
            <span>File</span>
            <input type="checkbox">
        </div>
        <div class="floating-menu-container flex col gap-3">
            <div class="flex gap-1">File:&nbsp;<span id="filename-display">Unnamed</span></div>
            <div>
                <button id="save-scheme">Save</button>
                <button id="load-scheme">Load</button>
                <button id="add-scheme">Add</button>
                <button id="clear-canvas">Clear</button>
            </div>
        </div>
    </div>

    <div class="floating-menu" style="left: 50%; top: 85%;">
        <div class="floating-menu-header">
            <span>Simulation</span>
            <input type="checkbox">
        </div>
        <div class="floating-menu-container align-items-center">
            <button id="start-sim">⏵</button>
            <button id="step-sim">⏭</button>
            <button id="stop-sim">⏹</button>
            <input type="number" id="speed-sim" min="1" max="1000" value="40" style="width:50px;">
            <label for="speed-sim">Hz</label>
        </div>
    </div>

    <div class="floating-menu hidden" id="fm-user-manual">
        <div class="floating-menu-header"><span>User Manual</span><button class="hide"></button></div>
        <div class="floating-menu-container col resizeable">
            <details class="collapse-section">
                <summary>Dots Menu</summary>
                <div class="content">
                    <ul>
                        <li> <b>Dots Menu</b>: Dots icon toggles Dots Menu visibility </li>
                        <li> <b>Switch Theme</b>: Moon/Sun - Dark/Bright</li>
                        <li> <b>User Manual</b>: Question mark icon toggles user manual visibility. User Manual FM is
                            resizeable.</li>
                    </ul>
                </div>
            </details>
            <details class="collapse-section">
                <summary>Controls</summary>
                <div class="content">
                    <ul>
                        <li> <b>Zoom In/Out</b>: Mouse Wheel (scroll) OR <code>+</code>/<code>-</code> keys.</li>
                        <li> <b>Pan Workspace</b>: Hold Mouse Wheel + Drag OR <code>Ctrl + Arrow Keys</code> /
                            <code>Ctrl + Shift + Arrow Keys</code>.
                        </li>
                    </ul>
                </div>
            </details>
            <details class="collapse-section">
                <summary>Floating Menus (FM)</summary>
                <div class="content">
                    <p>
                        The screen contains several Floating Menus.
                    <ul>
                        <li> <b>Move</b>: Drag the top bar of a menu.</li>
                        <li> <b>Collapse/Expand</b>: Click the <code>&lt;</code> icon (if present).</li>
                        <li> <b>Close</b>: Click the <code>X</code> icon The menu will become completely
                            invisible.</li>
                        <li> <b>Boundaries</b>: Windows cannot be dragged outside the application window.</li>
                    </ul>

                    </p>
                </div>
            </details>
            <details class="collapse-section">
                <summary>FM: Tools</summary>
                <div class="content">
                    <details class="collapse-section">
                        <summary>Move Tool</summary>
                        <div class="content">
                            <p>
                                Activates move/selection mode.
                            <ul>
                                <li> <b>Area Selection</b>: Hold Left Mouse Button (LMB) and drag to select elements
                                    within
                                    the area.</li>
                                <li> <b>Move Element(s)</b>: LMB on an element + Drag OR use
                                    <code>Arrow Keys</code>/`Shift+Arrow
                                    Keys`. Moves all selected elements if an area is selected.
                                </li>
                                <li> <b>Interact with Element(s)</b>: Right-Click (RMB) on an element to:
                                    <ul>
                                        <li> Press a button/toggle a switch.</li>
                                        <li> Change a logical operation.</li>
                                        <li> Change a timer's delay.</li>
                                        <li> In a selected area, the action applies to all elements of the same class.
                                        </li>
                                    </ul>
                                </li>
                                <li> <b>Duplicate</b>: <code>Ctrl+V</code> (English keyboard layout only) duplicates
                                    selected elements
                                    under the cursor. Behavior depends on the <b>Copy wires</b> mode.</li>
                                <li> <b>Delete</b>: <code>Delete</code> key removes selected elements.</li>
                            </ul>

                            </p>
                        </div>
                    </details>
                    <details class="collapse-section">
                        <summary>Connect Tool</summary>
                        <div class="content">
                            <p>
                                Activates connection mode.
                            <ul>
                                <li> <b>Add Source</b>: LMB on an element adds it to the source list.</li>
                                <li> <b>Add Target</b>: RMB on an element adds it to the target list.</li>
                                <li> <b>Area Selection</b>: Hold and drag LMB/RMB to select elements within the area.
                                </li>
                                <li> <b>Connect</b>: <code>Enter</code> connects all sources to all targets.</li>
                                <li> <b>Show Connections</b>: Press Mouse Wheel on an element to display all its
                                    incoming
                                    and outgoing connections.</li>
                                <li> <b>Cancel Selection</b>: <code>Esc</code>.</li>
                                <li> <b>Disconnect</b>: <code>Backspace</code> disconnects all sources from all targets.
                                </li>
                            </ul>

                            </p>
                        </div>
                    </details>
                    <details class="collapse-section">
                        <summary>Paint Tool</summary>
                        <div class="content">
                            <p>
                                Activates painting mode.
                            <ul>
                                <li> <b>Area Selection</b>: Hold LMB and drag to select elements within the area.</li>
                                <li> <b>Move Element(s)</b>: LMB on an element + Drag OR use
                                    <code>Arrow Keys</code>/<code>Shift+Arrow Keys</code>. Moves all selected elements
                                    if an
                                    area is
                                    selected.
                                </li>


                                <li> <b>Interact with Element(s)</b>: RMB on an element (same behavior as in Move Tool).
                                </li>
                                <li> <b>Recolor</b>: <code>Enter</code> changes the color of selected elements to the
                                    current <b>ColorPicker</b> color.
                                </li>

                                <li> <b>Delete</b>: <code>Delete</code> key removes selected elements.</li>
                            </ul>

                            </p>
                        </div>
                    </details>
                    <details class="collapse-section">
                        <summary>Additional Buttons & Actions</summary>
                        <div class="content">
                            <p>
                            <ul>
                                <li> <b>ColorPicker</b>: The square next to the Paint tool allows you to select a color
                                    for
                                    painting and new elements.</li>
                                <li> <b>Copy wires Mode</b>: Toggles wire copying behavior during duplication.</li>
                                <ul>
                                    <li> <code>None</code>: No wires are copied.</li>
                                    <li> <code>Inner</code>: Only wires within the selection are copied.</li>
                                    <li> <code>All</code>: All connected wires are copied.</li>
                                </ul>

                                <li> <b>Show wires Mode</b>: Toggles wire visibility.</li>
                                <ul>
                                    <li> <code>None</code>: Wires are hidden.</li>
                                    <li> <code>Connect</code>: Wires are visible only in Connect mode.</li>
                                    <li> <code>Temporary</code>: Only temporary wires (in Connect mode) are visible.
                                    </li>
                                    <li> <code>Always</code>: Wires are always visible.</li>
                                </ul>
                                <li><b>Edit LogEq</b>: Opens the logic expression editor.</li>
                            </ul>
                            </p>
                        </div>
                    </details>

                </div>
            </details>
            <details class="collapse-section">
                <summary>FM: Simulation</summary>
                <div class="content">
                    <p>
                    <ul>
                        <li> <b>Start ⏵</b>: Starts the simulation; signals begin propagating.</li>
                        <li> <b>Step ⏭</b>: Pauses the simulation and executes a single simulation step.</li>
                        <li> <b>Stop ⏹</b>: Pauses the simulation.</li>
                        <li> <b>Frequency Input (<code>...Hz</code>)</b>: Sets the simulation speed in Hertz.</li>
                    </ul>

                    </p>
                </div>
            </details>
            <details class="collapse-section">
                <summary>FM: LogEq Editor</summary>
                <div class="content">
                    <p>

                    <ul>
                        <li> <b>Clear Button</b>: Deletes all text in the editor.</li>
                        <li> <b>Parse Button</b>: Parses the logic expression and adds the corresponding circuit to
                            the workspace.</li>
                        <li> <b>Args Dropdown Menu</b>: Defines the component type for free arguments in the
                            expression:</li>
                        <li> <code>AND</code>: Logic AND gate.</li>
                        <li> <code>Switch</code>: Toggle switch.</li>
                        <li> <code>Button</code>: Button.</li>
                    </ul>

                    </p>
                </div>
            </details>
            <details class="collapse-section">
                <summary>FM: File</summary>
                <div class="content">
                    <p>
                    <ul>
                        <li> <b>File Name Field</b>: Displays the name of the current file. This name will be used for
                            saving. If supported by the browser, changing the name here and saving will rename the file
                            on
                            disk.</li>
                        <li> <b>Save Button</b>: Exports the current circuit to a file (JSON format). If supported by
                            the
                            browser, it saves changes to the currently open file.</li>
                        <li> <b>Load Button</b>: Imports a saved file and restores the circuit on the workspace.</li>
                        <li> <b>Add Button</b>: Adds imported circuit to current one. Does not affect current file
                            pointer.
                        </li>
                        <li> <b>Clear Button</b>: Clears the workspace, deletes the circuit, and resets the current file
                            pointer.</li>
                    </ul>
                    </p>
                </div>
            </details>
            <details class="collapse-section">
                <summary>FM: Elements</summary>
                <div class="content">
                    <p>
                        <b>Add Component</b>: LMB on a component in the palette adds it to the workspace (places it
                        randomly
                        in the center, sometimes underneath existing elements).<br>
                        This palette contains all available circuit components:
                    <ul>
                        <li> <b>Logic Gates</b>: AND, OR, XOR, NAND, NOR, XNOR</li>
                        <li> <b>Sequential Logic</b>: T-Flip-Flop (T-Flop)</li>
                        <li> <b>Timing</b>: Timer (delays an incoming signal sequence by N simulation ticks)</li>
                        <li> <b>Inputs</b>: Button (sends a signal for 1 tick), Switch</li>
                        <li> <b>Output</b>: Output (indicator lamp)</li>
                    </ul>
                    </p>
                </div>
            </details>
        </div>
    </div>

    <canvas id="circuit-canvas"></canvas>
    <input type="file" id="file-input" style="display:none" />
    <script type="module" src="src/consts.ts"></script>
    <script type="module" src="src/logic.ts"></script>
    <script type="module" src="src/drawing.ts"></script>
    <script type="module" src="src/drawingWGL.ts"></script>
    <script type="module" src="src/main.ts"></script>

</body>

</html>
